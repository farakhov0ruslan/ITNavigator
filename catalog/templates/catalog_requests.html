{% extends "base.html" %}
{% load static %}

{% block title %}Запросы на ИТ-решения{% endblock %}

{% block head %}
<style>
  .catalog-header {
    display: flex;
    flex-wrap: wrap;
    gap: 1rem;
    align-items: center;
    margin-bottom: 1rem;
  }
  .total-count {
    background-color: #0A2342;
    color: #fff;
    padding: .5rem 1rem;
    border-radius: 1rem;
    font-weight: 500;
    white-space: nowrap;
  }
  .search-input {
    flex: 1;
    min-width: 200px;
  }
  .card.custom-card {
    background-color: #e8eff5;
    border: none;
    cursor: pointer;
  }
  .card.custom-card .card-body {
    border-radius: 0 0 .5rem .5rem;
  }
</style>
{% endblock %}

{% block content %}
<div class="container my-4">
  <h2 class="mb-2 text-white">Запросы на ИТ-решения</h2>
  <p class="text-light mb-4">
    Здесь вы можете оставить запрос на поиск ИТ-решения, либо предложить своё решение на открытый запрос.
  </p>

  <form method="get" action="">
    <div class="catalog-header">
      <div class="total-count">
        Открытых запросов: <strong>{{ requests|length }}</strong>
      </div>

      <input
        type="text"
        name="q"
        class="form-control search-input"
        placeholder="Поиск запроса…"
        value="{{ search_query }}"
        aria-label="Поиск запроса"
      />

      <button type="submit" class="btn btn-outline-light">Поиск</button>
    </div>
  </form>

  <div class="row g-4">
    {% for req in requests %}
      <div class="col-12 col-md-6 col-lg-4">
        <div
          class="card custom-card h-100 shadow-sm"
          data-bs-toggle="modal"
          data-bs-target="#requestDetailModal"
          data-bs-title="{{ req.title }}"
          data-bs-description="{{ req.short_description }}"
          data-bs-contact="{{ req.contact_name }}"
          data-bs-company="{{ req.company_name }}"
          data-bs-phone="{{ req.phone }}"
          data-bs-email="{{ req.email }}"
          data-bs-inn="{{ req.inn }}"
        >
          <div class="card-body">
            <h5 class="card-title">{{ req.title|truncatechars:45 }}</h5>
            <p class="card-text">{{ req.short_description|truncatechars:80 }}</p>
          </div>
        </div>
      </div>
    {% empty %}
      <div class="col-12">
        <p class="text-light">Пока нет одобренных запросов.</p>
      </div>
    {% endfor %}
  </div>
</div>

<!-- Модальное окно с деталями запроса -->
<div
  class="modal fade"
  id="requestDetailModal"
  tabindex="-1"
  aria-labelledby="requestDetailModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="requestDetailModalLabel"></h5>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
          aria-label="Закрыть"
        ></button>
      </div>
      <div class="modal-body">
        <p id="requestDetailDescription"></p>
        <hr>
        <p class="mb-1"><strong>Контактное лицо:</strong> <span id="requestDetailContact"></span></p>
        <p class="mb-1"><strong>Компания / ИП:</strong> <span id="requestDetailCompany"></span></p>
        <p class="mb-1"><strong>ИНН:</strong> <span id="requestDetailINN"></span></p>
        <p class="mb-1"><strong>Телефон:</strong> <span id="requestDetailPhone"></span></p>
        <p class="mb-3"><strong>Email:</strong> <span id="requestDetailEmail"></span></p>
        <p class="text-muted fst-italic">
          Чтобы откликнуться на IT-решение, напишите контактному лицу.
        </p>
      </div>
      <div class="modal-footer">
        <button
          type="button"
          class="btn btn-secondary"
          data-bs-dismiss="modal"
        >
          Закрыть
        </button>
      </div>
    </div>
  </div>
</div>

<script>
  const reqModal = document.getElementById('requestDetailModal');
  reqModal.addEventListener('show.bs.modal', event => {
    const card = event.relatedTarget;
    reqModal.querySelector('#requestDetailModalLabel').textContent =
      card.getAttribute('data-bs-title');
    reqModal.querySelector('#requestDetailDescription').textContent =
      card.getAttribute('data-bs-description');
    reqModal.querySelector('#requestDetailContact').textContent =
      card.getAttribute('data-bs-contact');
    reqModal.querySelector('#requestDetailCompany').textContent =
      card.getAttribute('data-bs-company');
    reqModal.querySelector('#requestDetailINN').textContent =
      card.getAttribute('data-bs-inn');
    reqModal.querySelector('#requestDetailPhone').textContent =
      card.getAttribute('data-bs-phone');
    reqModal.querySelector('#requestDetailEmail').textContent =
      card.getAttribute('data-bs-email');
  });
</script>
{% endblock %}
